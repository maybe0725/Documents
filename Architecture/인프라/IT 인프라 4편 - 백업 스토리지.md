# IT 인프라 4편 - 백업 스토리지

<br/>

> 출처 - https://judo0179.tistory.com/33?category=294005

<br/>

## 백업, 데이터 보호

백업이란 사용자가 사용하는 정보 시스템에서 가장 중요한 데이터를 보호하기 위해서 다른 저장매체를 활용하여 저장했다가, 장애발생, 재해, 등 유사사항시 데이터 손실이 발생했을 경우 원래의 데이터를 복구하기 위해서 하는 활동으로 정의할 수 있습니다.

## 백업의 종류

백업의 종류는 백업을 받는 대상에 따라서 분류될 수 있습니다.

- **시스템 백업** : 운영체제와 같은 시스템 백업을 말합니다.

- **데이터 백업** : 데이터베이스 백업과 파일 시스템 백업으로 구분할 수 있습니다.

백업은 구성 방식에 따라서도 분류될 수 있습니다.

- 직접연결 백업

  서버와 백업장비를 1:1 관계로 직접 연결하여 백업받는 형식으로서 SCSI나 FC 등 과, 서버마다 별도의 백업 소프트웨어를 통해서 활용하는 방식입니다.

  최근에는 SCSI 케이블은 성능이나 관리 측면에서 FC에 비해 떨어지기 때문에 잘 사용되지 않습니다. DAS 시스템과 비슷한 개념으로 생각하면 판합니다.

- 네트워크 백업

  LAN을 통해서 백업장비와 서버를 접속하는 개념으로, 별도의 백업 관리 서버에 백업 장비를 연결하고 각각의 서버는 백업 서버를 통해서 백업을 수행하는 방식을 말합니다.

  NAS와 상당히 유사하나 기존의 서비스 네트워크를 사용할 경우 트래픽 발생량이 높기 때문에 별도의 네트워크로 분리하여 구성하는 경우도 있으나 이 경우 별도의 네트워크를 증설해야 하고, 추가적인 비용이 동반되기 때문에 현재 구성된 인프라 구성이나 백업 솔루션에 따라 차이가 발생하게 됩니다.

  일반적으로 서비스 민감도가 크지 않고 업무 시간외에 백업을 진행하는 경우라면 기존의 네트워크에 백업 솔루션을 설치하는 경우도 있지만, 관리 서버가 몇 백대 이상이 된다면 아무리 설계가 잘되어 있다고 만만치 않기 때문에 실무에서는 별도의 백업 네트워크를 구성하는 것이 일반적입니다.

- SAN 백업

  백업받을 데이터 용량이 증가함에 따라 백업용 테이프 장치를 SAN을 통해 인식시켜서 FC를 통해서 백업장치로 직접 백업받는 방식을 말합니다.

  ![images](../../Images/2020/03/20200303-1010-01.png)

  네트워크의 속도와 안전성이 비약적으로 발전하면서 SAN백업의 이점이 상대적으로 떨어진 면도 있으나 보수적인 전산 환경에서는 백업 용량 및 백업 복구 시간이 중요한 경우 SAN 백업을 고수하는 곳도 있으며 자체적으로 정책을 두고 겸용으로 사용하는 경우도 있습니다.

  ![images](../../Images/2020/03/20200303-1010-02.png)

  > DELL EMC의 경우 Data Domain VTL(Virtual Tape Library) 소프트웨어를 통해 LTO-1, LTO-2, LTO-3, LTO-4 가상 테이프 드라이브 및 무제한 테이프 카트리지를 통해 최대 64개의 가상 테이프 라이브러리를 에뮬레이트 할 수 있는 기술을 가지고 있습니다. <br/>
  > Data Domain 시스템은 Fibre Channel 기반의 Data Domain VTL(Virtual Tape Library), 이더넷 기반의 NAS(Network Attached Storage)용 원격 NDMP(Network Data Management Protocol) 액세스, 이더넷 기반의 NFS(Network File System) 및 CIFS(Common Internet File System) 파일 서비스 프로토콜, 그리고 EMC Data Domain Boost 등과 같은 다양한 방법을 통한 데이터 액세스 방식을 동시에 지원합니다. <br/>
  > 이러한 구축상의 유연성과 간편한 관리 기능을 바탕으로 사용자는 변화하는 엔터프라이즈 요구 사항에 신속하게 대응할 수 있습니다. <br/><br/>
  > 출처 : https://korea.emc.com/data-protection/data-domain/data-domain-virtual-tape-library.htm#!%EC%84%B8%EB%B6%80_%EC%A0%95%EB%B3%B4

<br/>

## 테이프를 이용한 전통적인 백업

일반적으로 테이프의 경우에는 DAT(Digital Audio Tape)와 LTO(Linear Tape Open) 2가지 종류가 있습니다.

- DAT

  ![images](../../Images/2020/03/20200303-1010-03.png)

- LTO

  ![images](../../Images/2020/03/20200303-1010-04.png)

이러한 테이프 백업장치는 순차적으로 데이터를 기록하게 됩니다. 테이프의 데이터 기록용량이 가득차게 된다면 기존 테이프를 꺼내서 새로운 테이프로 이어서 백업을 수행하게 됩니다.

DAT의 경우 상당히 오랜기간동안 사용했던 백업 장치이기 때문에 지금까지도 사용되는 곳이 있으며, 일일히 수동으로 백업을 진행하고 테이프에 데이터 백업 일자를 기록하고 일일히 관리를 해야 한다는 점에서 불편함이 있었습니다.

- 이러한 불편한 점을 해소하기 위해서 Tape Backup System이라는 것을 활용하여 자동으로 테이프 백업을 수행하는 기기도 별도로 존재합니다.

  > 과거에는 별도의 백업 스토리지가 존재하지 않았기 때문에 IBM 3422라는 릴 테이프를 사용하여 백업을 시행했을 만큼 과거부터 현재까지 꾸준히 테이프 저장장치는 유용한 매체로 사용되어 왔습니다.

  ![images](../../Images/2020/03/20200303-1010-05.png)

백업 테이프 현재까지도 용량과 속도를 향상시켜오면서 LTO-7의 경우 압축시 최대 15TB의 용량과 750MB/s 속도를 자랑하며 LTO-10 규격의 경우 120TB의 용량을 제공합니다.

하지만 한정된 공간내 데이터의 밀도가 높아지게 되면 오류가 발생할 확률이 증가하며, 가장 치명적으로 테이프의 오류가 나면 데이터 전체를 복구할 수 없기 때문에 같은 데이터를 여러 사본으로 관리하기도 합니다.

또한 순차적 작업이므로 필요한 데이터가 일부이더라도 반드시 처음부터 끝까지 모든 데이터를 읽어드려야 한다는 단점이 있습니다.

<br/>

## SATA를 이용한 VTL 백업

테이프 백업장치에 여러 단점으로 인하여 위에서 잠시 언급한 VTL(Virtual Tape Library) 장비가 탄생하게 되었습니다.

VTL는 SATA 디스크를 마치 백업 테이프인 것 처럼 에뮬레이션해서 데이터를 백업하는 장치입니다. VTL가 나오게 되면서 기존 테이프 백업방식은 PTL(Physical Tape Library) 용어로 다시 정의되었습니다.

이러한 방식은 기존에 사용했던 백업 소프트웨어를 그대로 사용할 수 있기 때문에 운영 환경의 변화가 크지 않다는 장점이 있으며, 디스크 백업을 통해 백업 시간과 복구 속도가 향상되었습니다.

또한 RAID를 활용하여 데이터 보호 기법을 적용할 수 있기 때문에 안전성도 크게 향상되었습니다.

하지만 VTL이 항상 장점만 있는 것은 아닙니다. PTL은 백업후 소산(원거리 보관)을 통해서 재난이 발생 했을 때라도 원거리에 데이터를 보관했기 때문에 백업할 수 있다는 장점이 있지만 초기 VTL의 겨우 수십 개의 디스를 제거해서 소산하기가 물리적으로 힘들기 때문입니다.

현재 출시되는 VTL의 경우 중복을 제거하고 DWDM(Dense Wavelength Division Multiplexing, 고밀도 파장 분할 다중) 전송망을 사용하여 장거리의 데이터를 복제하여 소산할 수 있는 방식을 사용하고 있습니다.

![images](../../Images/2020/03/20200303-1010-06.png)

![images](../../Images/2020/03/20200303-1010-07.png)

![images](../../Images/2020/03/20200303-1010-08.png)

- 광 전송을 활용한 방식으로써 단일 광섬유에 다른 파장을 사용하여 여러 반송파를 단일 광 케이블에 적용하는 기술을 말합니다.

- DWDM은 고밀도 파장을 활용하여 하나의 광 섬유의 최대 8개의 RX/TX를 동시에 송수신 할 수 있기 때문에 통신사 입장에서 더 많은 광 케이블을 포설하지 않더라도 네트워크의 용량을 확장하는 것이 가능하기 때문에 많이 사용되는 기술입니다.

- 대표적인 예로 이미 국내에서 상용화된 FTTH(Fibre To The Home)의 모뎀을 살펴보면 광 케이블 하나로 데이터 송수신이 가능한 것을 볼 수 있는데 바로 WDM기술을 활용했기 때문에 가능한 일입니다.

  ![images](../../Images/2020/03/20200303-1010-09.png)

> 국내 금융권의 관련 규제가 심한 편이기 때문에 반드시 데이터를 소산 후 금고에 보관하는 방식을 아직까지도 채택하고 있으며 KB금융의 경우 14년 기준 COBOL로 작성된 메인프레인을 아직까지도 운영하고 있어 인력 수급과 유지보수에 상당한 어려움을 가지고 있다고 합니다. 심지어 모 업체는 SW 수정을 위해서 해외에서 70대 개발자를 데려왔다는 이야기가 전해지기도 합니다.<br/>
> 이처럼 IT 인프라 분야는 빠르게 발전하는 분야이기도 하면서 보수적인 측면도 많이 남아있습니다.

<br/>

## VTL에서 데이터의 중복을 제거하는 기술

VTL를 설명하면서 데이터 중복을 제거한다고 언급했었습니다.

중복제거란 10TB의 전체 시스템 용량(풀백업)에서 하루의 변경되는 데이터가 10% 1TB라고 가정한다면 원본 정보의 실제 위치를 기록한 메타데이터를 별도로 기록하고 실제 변경된 용량만 백업을 받는 방식을 말합니다.

이를 통해 항상 풀백업을 받을 필요 없이 변경된 내용만 수정하면 되기 때문에 저장하는 데이터양을 획기적으로 줄일 수 있으며, 복구시에는 변경분과 메타데이터를 활용하여 완전하게 백업할 수 있습니다. (스냅샷과 비슷한 개념)

단, 반드시 백업본이 참조할 수 있도록 원본과 참조가능한 메타데이터가 유지 되어 있어야 변경 여부를 알 수 있습니다.

### 스토리지와 백업 장치의 구조

실제 백업 장치는 스토리지 구성형태와 비슷한 구조를 가지고 있습니다. 데이터를 백업받을 수 있는 미디어와 이를 연결하기 위한 인터페이스 구조로 이루어져 있으며, 보통은 FC를 활용하고 가용성을 위해서 이중화 방식을 채택하고 있습니다.

백업 장비는 PTL, VTL의 방식의 차이는 구분할 필요가 없으며, 백업 소프트웨어를 통해서 동일하게 관리할 수 있습니다.

### 중복제거 기술 들여보기

디스크 기반 백업 기술에서 가장 많이 언급되고 중요한 솔루션이 중복 제거입니다. 즉 앞에서 설명 했듯이 동일한 내용은 다시 저장하지 않고 변경된 내용만 저장해서 스토리지의 저장 효율을 향상시키는 방식입니다.

이러한 중복제거 기술은 다음 2가지 방법으로 나누어 집니다.

- 소스 기반의 중복 백업

  백업 대상 서버에 중복 제거 백업 솔루션을 설치하여 서버에서 직접 중복을 제거하고 백업하는 방법을 말합니다.

  대표적으로 dell emc avamar가 대표적인 솔루션입니다.

  ![images](../../Images/2020/03/20200303-1010-10.png)

  단, 백업을 받는 운영 서버에 부하가 발생하고 이는 업무에도 영향을 줄 수 있습니다.

- 타깃 기반의 중복제거

  백업 장치에서 중복을 제거하는 방식으로 이는 인라인 방식과 포스트 프로세싱 방식으로 나눠집니다.

  인라인 방식은 백업 중에 중복을 제거하는 방식으로 대용량 백업 시에 병목현상이 발생할 수 있다는 단점이 있으며, 포스트 프로세싱 방식은 백업 장치에서 백업 완료 후에 유휴 시간을 활용하여 백그라운드에서 중복을 제거하기 때문에 병목현상이 발생하지는 않지만 추가적인 저장공간이 필요하다는 단점이 있습니다.

  현재는 디스크의 I/O성능이 비약적으로 발전했기 때문에 인라인 방식이 대세가 되었습니다.

<br/>

## 백업의 중요성을 반영한 설계

백업 장비를 도입하기 전에는 아래와 같은 사항은 반드시 고려해야 합니다.

- 백업 목표 시간
- 복구 목표 시간
- 백업 주기
- 보관 주기
- 백업 용량
- 백업 정책

백업은 중요성에 비해 IT 투자 순위에서 항상 밀리는 편입니다. 별도의 백업 장비는 물론 백업 소프트웨어도 필요한데 가격이 만만치 않기 때문입니다.

- 아래는 2011년 6월 금융결제원의 전자수입인지 비용에 관한 문서의 내용을 발췌하였습니다.

  | 구분            | 비용(천원) | 비고                                                                         |
  | --------------- | ---------- | ---------------------------------------------------------------------------- |
  | 주 전산기       | 825,820    | WEB 서버 3대, WAS 서버 2대, 연동서버 2대, DB 2대, 인증서버 2대, 개발서버 1대 |
  | 백업장비        | 405,050    | WEB 서버 3대, WAS 서버, 연동서버, DB서버, 인증서버, 개발서버 각 1대          |
  | 스토리지        | 705,600    | 주센터, 백업센터 각1대                                                       |
  | VTL, PTL        | 336,000    | 주센터, 백업센터 각1대                                                       |
  | Real S/W        | 1,985,468  | WEB S/W 외 16종                                                              |
  | Back up(DR) S/W | 908,545    | WAS S/W 외 12종                                                              |

- 추가적으로 유지보수 비용과 인력, 서비스 구축 등 연간 23억원을 사용한다고 합니다.

- 위의 온프레미스로 구축한 단적인 예만 살펴보더라도 많은 비용이 들어가는 만큼 오프 프래미스로 백업 솔루션도 고려해야 합니다.

  ![images](../../Images/2020/03/20200303-1010-11.png)

- 위의 그림은 AWS Storage Gateway의 구성도로, 테이프 백업을 클라우드 스토리지 형태로 저장하는 서비스입니다.

- 사용한 만큼 비용을 지불하기 때문에 도입시 초기비용은 낮은 편이지만, 백업 용량이 급격하게 증가한다면 용량도 급격하게 증가한다는 점, 안전성, 속도, 보안, 국내 법규등 위배되는 사항이 있는지 등 꼼꼼히 체크하는 것이 중요합니다.

대표적인 백업 장비 업체는 다음과 같습니다.

- **PTL** : 오라클 SL 시리즈, 퀀텀 스칼라 시리즈 , HPE 스토어에버 시리즈, IBM TS 시리즈

  ![images](../../Images/2020/03/20200303-1010-12.png)

- **VTL** : EMC DD(데이터 도메인)시리즈, 퀀텀 DXi 시리즈, 시만텍 넷백업 어플라이언스 시리즈

  ![images](../../Images/2020/03/20200303-1010-13.png)

전통적인 PTL방식은 앞으로도 계속 유지될 것으로 보입니다. 보안문제, 소산, 암호화 등 여전히 이점을 가지고 있으며 금율감독원의 보안 규정도 충족할 수 있기 때문입니다.

빅데이터 시대에는 스토리지의 용량뿐만 아니라 백업에 필요한 용량도 함께 증가하기 때문에 디스크 기반 솔루션으로 이를 처리하기 위해서는 비용부담이 크기 때문에 PTL을 버릴 수 없습니다.

VTL 컨트롤러의 경우 많은 성능향상이 이루어졌으나 디스크는 저가의 SATA 방식을 사용하는 것이 대부분입니다.

백업 장비들이 대부분 x86 시스템으로 이전되고 있기 때문에 x86을 이해하는 것이 앞으로 중요할 것으로 보입니다.
